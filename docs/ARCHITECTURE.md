# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° SQL Hero

ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° SQL Hero.

---

## ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

SQL Hero â€” ÑÑ‚Ğ¾ Telegram WebApp Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ MySQL Ñ Ğ³ĞµĞ¹Ğ¼Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸ĞµĞ¹.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Telegram Users                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Telegram Bot API                          â”‚
â”‚              (BotFather, WebApp API)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend       â”‚    â”‚   Backend        â”‚
â”‚   (React + TS)   â”‚â—„â”€â”€â”€â”¤   (FastAPI)      â”‚
â”‚   Port 5173      â”‚    â”‚   Port 8000      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                       â”‚
                 â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Main Database  â”‚    â”‚  Sandbox MySQL  â”‚
        â”‚  (User data)    â”‚    â”‚  (User schemas) â”‚
        â”‚  MySQL 8.0      â”‚    â”‚  MySQL 8.0      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Backend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸

- **FastAPI** â€” Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ²ĞµĞ±-Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº
- **SQLAlchemy 2.0** â€” async ORM
- **Alembic** â€” Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ”
- **Pydantic** â€” Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- **PyJWT** â€” JWT Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ Ğ´Ğ»Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
- **aiomysql** â€” Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€ MySQL
- **Uvicorn** â€” ASGI ÑĞµÑ€Ğ²ĞµÑ€

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/                   # Ğ¯Ğ´Ñ€Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ config.py           # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¸Ğ· .env
â”‚   â”‚   â”œâ”€â”€ database.py         # Database engine Ğ¸ session
â”‚   â”‚   â”œâ”€â”€ security.py         # JWT, Telegram auth, password
â”‚   â”‚   â””â”€â”€ exceptions.py       # ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # SQLAlchemy Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”‚   â”‚   â”œâ”€â”€ database.py         # Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ‘Ğ”
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                # Pydantic ÑÑ…ĞµĞ¼Ñ‹
â”‚   â”‚   â”œâ”€â”€ user.py             # User schemas
â”‚   â”‚   â”œâ”€â”€ course.py           # Module, Lesson schemas
â”‚   â”‚   â”œâ”€â”€ progress.py         # Progress schemas
â”‚   â”‚   â”œâ”€â”€ achievement.py      # Achievement schemas
â”‚   â”‚   â””â”€â”€ sandbox.py          # Sandbox schemas
â”‚   â”‚
â”‚   â”œâ”€â”€ routers/                # API endpoints
â”‚   â”‚   â”œâ”€â”€ auth.py             # /api/auth/*
â”‚   â”‚   â”œâ”€â”€ course.py           # /api/modules/*, /api/lessons/*
â”‚   â”‚   â”œâ”€â”€ progress.py         # /api/progress/*
â”‚   â”‚   â”œâ”€â”€ achievements.py     # /api/achievements/*
â”‚   â”‚   â”œâ”€â”€ leaderboard.py      # /api/leaderboard/*
â”‚   â”‚   â”œâ”€â”€ dashboard.py        # /api/dashboard/*
â”‚   â”‚   â””â”€â”€ sandbox.py          # /api/sandbox/*
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
â”‚   â”‚   â”œâ”€â”€ user_service.py     # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
â”‚   â”‚   â”œâ”€â”€ course_service.py   # ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¸ ÑƒÑ€Ğ¾ĞºĞ¸
â”‚   â”‚   â”œâ”€â”€ progress_service.py # ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¸ XP
â”‚   â”‚   â”œâ”€â”€ achievement_service.py # Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ sandbox_service.py  # SQL Ğ¿ĞµÑĞ¾Ñ‡Ğ½Ğ¸Ñ†Ğ°
â”‚   â”‚   â”œâ”€â”€ leaderboard_service.py # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²
â”‚   â”‚   â””â”€â”€ notification_service.py # Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ (future)
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/                    # CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
â”‚   â”‚   â”œâ”€â”€ seed_data.py        # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
â”‚   â”‚   â”œâ”€â”€ check_db.py         # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ‘Ğ”
â”‚   â”‚   â””â”€â”€ clear_db.py         # ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ‘Ğ” (dev)
â”‚   â”‚
â”‚   â””â”€â”€ main.py                 # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° FastAPI app
â”‚
â”œâ”€â”€ tests/                      # Ğ¢ĞµÑÑ‚Ñ‹
â”‚   â”œâ”€â”€ e2e/                    # E2E Ñ‚ĞµÑÑ‚Ñ‹ (SQLite)
â”‚   â”‚   â”œâ”€â”€ conftest.py         # Fixtures Ğ´Ğ»Ñ E2E
â”‚   â”‚   â”œâ”€â”€ test_e2e_auth.py
â”‚   â”‚   â”œâ”€â”€ test_e2e_course.py
â”‚   â”‚   â”œâ”€â”€ test_e2e_progress.py
â”‚   â”‚   â”œâ”€â”€ test_e2e_achievements.py
â”‚   â”‚   â”œâ”€â”€ test_e2e_leaderboard.py
â”‚   â”‚   â”œâ”€â”€ test_e2e_dashboard.py
â”‚   â”‚   â””â”€â”€ test_e2e_sandbox_security.py
â”‚   â”‚
â”‚   â””â”€â”€ conftest.py             # ĞĞ±Ñ‰Ğ¸Ğµ fixtures
â”‚
â”œâ”€â”€ alembic/                    # ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
â”‚   â”œâ”€â”€ versions/               # Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
â”‚   â”œâ”€â”€ env.py                  # Alembic environment
â”‚   â””â”€â”€ script.py.mako          # Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
â”‚
â”œâ”€â”€ pyproject.toml              # Poetry ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”œâ”€â”€ alembic.ini                 # Alembic ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”œâ”€â”€ Dockerfile                  # Production Ğ¾Ğ±Ñ€Ğ°Ğ·
â””â”€â”€ .env.example                # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
```

### Ğ¡Ğ»Ğ¾Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

#### 1. Routers (API Layer)

ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑÑÑ‚ HTTP endpoints Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ request/response.

```python
# app/routers/auth.py
@router.post("/register", response_model=UserResponse)
async def register(
    data: TelegramInitData,
    db: AsyncSession = Depends(get_session)
):
    user = await user_service.register_user(db, data)
    return user
```

#### 2. Services (Business Logic Layer)

Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ, Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼ÑƒÑ Ğ¾Ñ‚ HTTP.

```python
# app/services/user_service.py
async def register_user(db: AsyncSession, data: TelegramInitData) -> User:
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Telegram
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    # Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
    return user
```

#### 3. Models (Data Layer)

SQLAlchemy Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸, Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‰Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ‘Ğ”.

```python
# app/models/database.py
class User(Base):
    __tablename__ = "users"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    telegram_id: Mapped[int] = mapped_column(BigInteger, unique=True)
    username: Mapped[str | None]
    xp: Mapped[int] = mapped_column(default=0)
    level: Mapped[int] = mapped_column(default=1)
```

#### 4. Schemas (Validation Layer)

Pydantic ÑÑ…ĞµĞ¼Ñ‹ Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….

```python
# app/schemas/user.py
class UserResponse(BaseModel):
    id: int
    telegram_id: int
    username: str | None
    xp: int
    level: int
    
    model_config = ConfigDict(from_attributes=True)
```

---

## Database ÑÑ…ĞµĞ¼Ğ°

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

#### users
Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑÑ….

```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    xp INT DEFAULT 0,
    level INT DEFAULT 1,
    streak_days INT DEFAULT 0,
    last_activity_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### modules
10 Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ ĞºÑƒÑ€ÑĞ° SQL.

```sql
CREATE TABLE modules (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    order_index INT NOT NULL,
    is_locked BOOLEAN DEFAULT FALSE,
    lessons_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### lessons
100+ ÑƒÑ€Ğ¾ĞºĞ¾Ğ² Ñ Ñ‚ĞµĞ¾Ñ€Ğ¸ĞµĞ¹, Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼Ğ¸ Ğ¸ Ñ‚ĞµÑÑ‚Ğ°Ğ¼Ğ¸.

```sql
CREATE TABLE lessons (
    id INT PRIMARY KEY AUTO_INCREMENT,
    module_id INT NOT NULL,
    title VARCHAR(255) NOT NULL,
    content TEXT,  -- Ğ¢ĞµĞ¾Ñ€Ğ¸Ñ ÑƒÑ€Ğ¾ĞºĞ°
    lesson_type ENUM('theory', 'task', 'quiz') NOT NULL,
    order_index INT NOT NULL,
    xp_reward INT DEFAULT 10,
    
    -- Ğ”Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° 'task'
    task_description TEXT,
    initial_db_state JSON,  -- ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ‘Ğ”
    expected_result JSON,   -- ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    solution_query TEXT,    -- ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ (ÑĞºÑ€Ñ‹Ñ‚Ğ¾)
    hints JSON,             -- ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸
    
    -- Ğ”Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° 'quiz'
    quiz_question TEXT,
    quiz_options JSON,
    quiz_correct_answer VARCHAR(255),
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (module_id) REFERENCES modules(id)
);
```

#### user_progress
ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ ÑƒÑ€Ğ¾ĞºĞ°Ğ¼.

```sql
CREATE TABLE user_progress (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    lesson_id INT NOT NULL,
    is_completed BOOLEAN DEFAULT FALSE,
    attempts INT DEFAULT 0,
    xp_earned INT DEFAULT 0,
    time_spent_seconds INT DEFAULT 0,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY unique_user_lesson (user_id, lesson_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (lesson_id) REFERENCES lessons(id)
);
```

#### achievements
50+ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸.

```sql
CREATE TABLE achievements (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    achievement_type ENUM('progress', 'streak', 'skill', 'special') NOT NULL,
    icon VARCHAR(50),  -- Emoji Ğ¸Ğ»Ğ¸ Ğ¸ĞºĞ¾Ğ½ĞºĞ°
    xp_reward INT DEFAULT 0,
    
    -- Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ
    condition_type VARCHAR(50),  -- 'complete_lessons', 'reach_level', etc.
    condition_value JSON,
    
    is_hidden BOOLEAN DEFAULT FALSE,  -- Ğ¡ĞºÑ€Ñ‹Ñ‚Ğ¾Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### user_achievements
Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ, Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸.

```sql
CREATE TABLE user_achievements (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    achievement_id INT NOT NULL,
    unlocked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY unique_user_achievement (user_id, achievement_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (achievement_id) REFERENCES achievements(id)
);
```

#### activity_logs
Ğ›Ğ¾Ğ³Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ñ‚ĞµĞ¿Ğ»Ğ¾Ğ²Ğ¾Ğ¹ ĞºĞ°Ñ€Ñ‚Ñ‹.

```sql
CREATE TABLE activity_logs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    activity_date DATE NOT NULL,
    actions_count INT DEFAULT 1,
    xp_earned INT DEFAULT 0,
    
    UNIQUE KEY unique_user_date (user_id, activity_date),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### Relationships

```
users
  â”œâ”€ user_progress (one-to-many)
  â”œâ”€ user_achievements (one-to-many)
  â””â”€ activity_logs (one-to-many)

modules
  â””â”€ lessons (one-to-many)

lessons
  â””â”€ user_progress (one-to-many)

achievements
  â””â”€ user_achievements (one-to-many)
```

---

## Frontend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸

- **React 19** â€” UI Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°
- **TypeScript** â€” Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
- **Vite 7** â€” build tool Ğ¸ dev server
- **React Router** â€” client-side routing
- **Axios** â€” HTTP ĞºĞ»Ğ¸ĞµĞ½Ñ‚
- **Telegram WebApp API** â€” Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Telegram
- **Monaco Editor** (Ğ¸Ğ»Ğ¸ Code Mirror) â€” SQL Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€
- **Recharts** (Ğ¸Ğ»Ğ¸ Chart.js) â€” Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ğ¸ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/                  # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx       # Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°
â”‚   â”‚   â”œâ”€â”€ ModulesMap.tsx      # ĞšĞ°Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
â”‚   â”‚   â”œâ”€â”€ ModuleDetail.tsx    # Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
â”‚   â”‚   â”œâ”€â”€ Lesson.tsx          # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° ÑƒÑ€Ğ¾ĞºĞ°
â”‚   â”‚   â”œâ”€â”€ Leaderboard.tsx     # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²
â”‚   â”‚   â”œâ”€â”€ Achievements.tsx    # Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â””â”€â”€ Profile.tsx         # ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
â”‚   â”‚
â”‚   â”œâ”€â”€ components/             # ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ Layout/             # Layout ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Navigation.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Lesson/             # ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑƒÑ€Ğ¾ĞºĞ°
â”‚   â”‚   â”‚   â”œâ”€â”€ TheoryContent.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskContent.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ QuizContent.tsx
â”‚   â”‚   â”‚   â””â”€â”€ LessonProgress.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ SQLEditor/          # SQL Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€
â”‚   â”‚   â”‚   â”œâ”€â”€ Editor.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultTable.tsx
â”‚   â”‚   â”‚   â””â”€â”€ QueryHistory.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Dashboard/          # ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ StatsCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ActivityHeatmap.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RecentAchievements.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ UI/                 # UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚       â”œâ”€â”€ Button.tsx
â”‚   â”‚       â”œâ”€â”€ Card.tsx
â”‚   â”‚       â”œâ”€â”€ Modal.tsx
â”‚   â”‚       â”œâ”€â”€ Loading.tsx
â”‚   â”‚       â””â”€â”€ ErrorBoundary.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # API ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ api.ts              # Axios instance
â”‚   â”‚   â”œâ”€â”€ authService.ts      # Authentication
â”‚   â”‚   â”œâ”€â”€ courseService.ts    # Modules and Lessons
â”‚   â”‚   â”œâ”€â”€ progressService.ts  # User progress
â”‚   â”‚   â”œâ”€â”€ sandboxService.ts   # SQL execution
â”‚   â”‚   â”œâ”€â”€ achievementService.ts
â”‚   â”‚   â””â”€â”€ leaderboardService.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                  # Custom hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts          # Authentication state
â”‚   â”‚   â”œâ”€â”€ useUser.ts          # User data
â”‚   â”‚   â”œâ”€â”€ useLessons.ts       # Lessons data
â”‚   â”‚   â”œâ”€â”€ useTelegram.ts      # Telegram WebApp API
â”‚   â”‚   â””â”€â”€ useLocalStorage.ts  # Local storage
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                  # TypeScript types
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ course.ts
â”‚   â”‚   â”œâ”€â”€ progress.ts
â”‚   â”‚   â”œâ”€â”€ achievement.ts
â”‚   â”‚   â””â”€â”€ telegram.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ telegramAuth.ts     # Telegram init data parsing
â”‚   â”‚   â”œâ”€â”€ xpCalculator.ts     # XP and level calculations
â”‚   â”‚   â”œâ”€â”€ dateUtils.ts
â”‚   â”‚   â””â”€â”€ validators.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                 # Ğ¡Ñ‚Ğ¸Ğ»Ğ¸
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â””â”€â”€ themes/
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                 # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚
â”‚   â”œâ”€â”€ main.tsx                # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°
â”‚   â””â”€â”€ vite-env.d.ts           # Vite types
â”‚
â”œâ”€â”€ public/                     # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ favicon.ico
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ .env.example
```

### State Management

ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ React hooks Ğ¸ Context API Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼.

```typescript
// src/contexts/AuthContext.tsx
export const AuthContext = createContext<AuthContextType | null>(null);

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [token, setToken] = useState<string | null>(null);
  
  // Authentication logic
  
  return (
    <AuthContext.Provider value={{ user, token, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
};
```

---

## Sandbox Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ SQL Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

SQL Hero Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ MySQL ÑÑ…ĞµĞ¼Ñ‹ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.

```
Main Database (sqlhero)
  â”œâ”€ users, modules, lessons, ... (app data)
  
User Sandboxes (per user)
  â”œâ”€ sandbox_user_123 (user 123's schema)
  â”œâ”€ sandbox_user_456 (user 456's schema)
  â””â”€ sandbox_user_789 (user 789's schema)
```

### Query Execution Flow

```
1. User submits SQL query
   â†“
2. Frontend â†’ Backend API (/api/sandbox/execute)
   â†“
3. Validate query (Query Validator)
   â”œâ”€ Block dangerous operations (DROP, ALTER, etc.)
   â”œâ”€ Block system tables (mysql.user, etc.)
   â””â”€ Block excessive result sets
   â†“
4. Create/Use user sandbox schema (sandbox_user_{id})
   â†“
5. Setup lesson initial data (if first time)
   â†“
6. Execute query with timeout (5 seconds)
   â†“
7. Compare result with expected_result
   â†“
8. Return result to frontend
   â”œâ”€ Success: mark lesson complete, award XP
   â””â”€ Failure: show error, give hints
```

### Security measures

1. **Query Validator** â€” Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
2. **Schema Isolation** â€” ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ² ÑĞ²Ğ¾ĞµĞ¹ ÑÑ…ĞµĞ¼Ğµ
3. **Timeout** â€” Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ñ‹ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
4. **Result Limit** â€” Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 1000 ÑÑ‚Ñ€Ğ¾Ğº Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
5. **Read-Only User** (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) â€” Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ±ĞµĞ· Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ

---

## Authentication Flow

### Telegram WebApp Auth

```
1. User opens bot in Telegram
   â†“
2. User clicks "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ" button
   â†“
3. Telegram opens WebApp with initData
   â†“
4. Frontend extracts initData
   â†“
5. Frontend â†’ Backend (/api/auth/telegram)
   â†“
6. Backend validates initData signature (HMAC SHA-256)
   â”œâ”€ Check hash matches
   â”œâ”€ Check auth_date is recent
   â””â”€ Verify with TELEGRAM_BOT_TOKEN
   â†“
7. Create/Update user in database
   â†“
8. Generate JWT token
   â†“
9. Return token to frontend
   â†“
10. Frontend stores token in localStorage
    â†“
11. All subsequent requests include token in Authorization header
```

### JWT Token

```python
{
  "user_id": 123,
  "telegram_id": 987654321,
  "exp": 1234567890,  # Expiration (7 days)
  "iat": 1234567890   # Issued at
}
```

---

## API Design

### RESTful Endpoints

```
Authentication:
POST   /api/auth/telegram          # Telegram auth
GET    /api/auth/me                # Get current user

Course:
GET    /api/modules                # List modules
GET    /api/modules/{id}           # Module details
GET    /api/modules/{id}/lessons   # Module lessons
GET    /api/lessons/{id}           # Lesson details

Progress:
GET    /api/progress               # User progress
POST   /api/progress/complete      # Mark lesson complete
GET    /api/progress/stats         # User stats

Sandbox:
POST   /api/sandbox/execute        # Execute SQL query
POST   /api/sandbox/reset          # Reset sandbox

Achievements:
GET    /api/achievements           # List achievements
GET    /api/achievements/user      # User achievements

Leaderboard:
GET    /api/leaderboard            # Top users
GET    /api/leaderboard/friends    # Friends leaderboard

Dashboard:
GET    /api/dashboard/stats        # Dashboard stats
GET    /api/dashboard/activity     # Activity heatmap
```

---

## Performance Optimizations

### Backend

1. **Database Connection Pooling**
   ```python
   engine = create_async_engine(
       DATABASE_URL,
       pool_size=10,
       max_overflow=20,
   )
   ```

2. **Caching** (future)
   - Redis Ğ´Ğ»Ñ leaderboard Ğ¸ stats
   - Cache Ğ´Ğ»Ñ module/lesson lists

3. **Indexes**
   ```sql
   CREATE INDEX idx_user_telegram_id ON users(telegram_id);
   CREATE INDEX idx_progress_user_lesson ON user_progress(user_id, lesson_id);
   CREATE INDEX idx_activity_user_date ON activity_logs(user_id, activity_date);
   ```

### Frontend

1. **Code Splitting**
   ```typescript
   const Dashboard = React.lazy(() => import('./pages/Dashboard'));
   ```

2. **Memoization**
   ```typescript
   const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
   ```

3. **Virtual Scrolling** (Ğ´Ğ»Ñ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… ÑĞ¿Ğ¸ÑĞºĞ¾Ğ²)

---

## Monitoring & Logging

### Backend Logging

```python
import logging

logger = logging.getLogger(__name__)

logger.info(f"User {user_id} completed lesson {lesson_id}")
logger.error(f"SQL execution failed: {error}", exc_info=True)
```

### Error Tracking

- **Sentry** Ğ´Ğ»Ñ production error tracking
- **Custom error handlers** Ğ² FastAPI

### Performance Monitoring

- **Response time logging**
- **Database query profiling**
- **Resource usage monitoring**

---

## Deployment Architecture

### Production Setup

```
[Users] â†’ [Cloudflare CDN] â†’ [Frontend (Vercel)]
                                      â†“ HTTPS
                                [Backend (Railway/VPS)]
                                      â†“
                                [MySQL (Managed DB)]
```

---

## Future Improvements

- [ ] Redis Ğ´Ğ»Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- [ ] WebSocket Ğ´Ğ»Ñ real-time updates
- [ ] GraphQL API (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
- [ ] Microservices (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
- [ ] Kubernetes Ğ´Ğ»Ñ orchestration
- [ ] CDN Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- [ ] Message Queue (RabbitMQ/Celery) Ğ´Ğ»Ñ async tasks

---

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ SQL Hero ğŸ—ï¸**
